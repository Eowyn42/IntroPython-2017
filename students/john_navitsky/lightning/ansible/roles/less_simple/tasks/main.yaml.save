---

- name: import network data
  include_vars:
    file: lightning_data.yaml

- name: hardcode my hostname for illustration
  set_fact:
    my_hostname="hostr1"
   
- name: extract my host data
  set_fact:
    my_hostdata="{{ lightning | json_query( query ) | first }}"
  vars:
    query: "hosts[?name=='{{my_hostname}}']"

- name: extract my network name
  set_fact:
    my_network="{{ my_hostdata | json_query( query ) | first }}"
  vars:
    query: "interfaces[*].network"

- name: extract my network data
  set_fact:
    my_netdata="{{ lightning.networks[my_network] }}"

- name: set network appropriate dns servers (/tmp/resolv.conf)
  lineinfile:
    path: /tmp/resolv.conf
    regexp: "^nameserver "
    line: "nameserver {{my_netdata['dns_servers']|join(' ')}}"
    create: yes
    backup: yes
